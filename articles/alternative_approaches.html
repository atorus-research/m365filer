<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>m365filer for Character Paths • m365filer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="m365filer for Character Paths">
<meta property="og:description" content="m365filer">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">m365filer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/m365filer.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/alternative_approaches.html">m365filer for Character Paths</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="alternative_approaches_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>m365filer for Character Paths</h1>
            
      
      
      <div class="hidden name"><code>alternative_approaches.Rmd</code></div>

    </div>

    
    
<p>The entire premise of the <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code> and <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> functions is that they work around file connection objects, which makes things slightly easier to abstract away from the user (minus the quirks of file connection objects in R). Not all functions allow this approach, and some functions only allow a user to pass a character file path, such as functions like <code>readxl::read_excel()</code>. Unfortunately, this means that <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code> and <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> won’t work and another approach must be used.</p>
<p>With m365filer, I’ve provided some tooling to work around this, which just means a couple extra steps. Some separate functions are to provide most of the same benefits.</p>
<div class="section level2">
<h2 id="reading-a-file">Reading a file<a class="anchor" aria-label="anchor" href="#reading-a-file"></a>
</h2>
<p>So if we can’t use file connections, what <em>can</em> we do. Instead of directly serving a file connection, we can use some helper functions to abstract away handling the local file paths. Let’s look at an example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/source_file.html">source_file</a></span><span class="op">(</span><span class="st">"Documents/test.csv"</span>, origin <span class="op">=</span> <span class="st">"onedrive"</span><span class="op">)</span>
<span class="va">fpath</span>
<span class="co">#&gt; [1] "Documents/test.csv"</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "source_file" "character"  </span>
<span class="co">#&gt; attr(,"origin")</span>
<span class="co">#&gt; [1] "onedrive"</span></code></pre></div>
<p>Starting here, what we’ve done is create a source file object. The object is very simple - it’s really just a character string with some extra attributes. But those attributes tell you where the file is supposed to live. In this example, we’ve given a path, but additionally indicated that the path is associated with OneDrive.</p>
<p>The next step is to actually get the file itself. There are two pieces to this:</p>
<ul>
<li>Getting the file connection object</li>
<li>Getting the file from the cloud</li>
</ul>
<p>Let’s take a look.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">od</span> <span class="op">&lt;-</span> <span class="fu">Microsoft365R</span><span class="fu">::</span><span class="fu">get_personal_onedrive</span><span class="op">(</span><span class="op">)</span>
<span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cloud_file.html">get_cloud_file</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_file_connection.html">get_file_connection</a></span><span class="op">(</span><span class="va">fpath</span>, drive<span class="op">=</span><span class="va">od</span><span class="op">)</span>, .close<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">file</span></code></pre></div>
<pre><code><span class="co">#&gt; [1] "C:\\Users\\16105\\AppData\\Local\\Temp\\Rtmpo7Nf7O/test.csv"</span></code></pre>
<p>So - what happened here? <code><a href="../reference/get_file_connection.html">get_file_connection()</a></code> returns a connection object, which is similar how <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> and <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code> handle their file management. <code><a href="../reference/get_cloud_file.html">get_cloud_file()</a></code> actually uses the connection object and downloads the file into the R session temporary directory.</p>
<p>Note the use of <code>.close</code>. You might be wondering - if I’m just using a connection object here, why not just use a <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> or a <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code>. Well, file connections in R are a bit quirky. When they’re closed, they’re eventually cleaned up and destroyed. This makes for an interesting one-time-use sort of scenario, but - you may what to use a file path multiple times. That’s why the source_file object exists in the first place; it gives a persistent reference to the file for the life of your session.</p>
<p>Something else to note is that while it’s clear that the path returned by <code>file</code> is a temporary path, it will be the <em>same</em> temporary path for the life of your session. For example, let’s run the same code again.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cloud_file.html">get_cloud_file</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_file_connection.html">get_file_connection</a></span><span class="op">(</span><span class="va">fpath</span>, drive<span class="op">=</span><span class="va">od</span><span class="op">)</span>, .close<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">file</span></code></pre></div>
<pre><code><span class="co">#&gt; [1] "C:\\Users\\16105\\AppData\\Local\\Temp\\Rtmpo7Nf7O/test.csv"</span></code></pre>
<p>The same file path is returned. Throughout your programming, this local file path can be used. Since it’s in the temporary directory, you don’t have to worry about cleanup because the system will eventually wipe it out for you.</p>
<p>Additionally, to restore some of the same benefits of using <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> or <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code>, <code><a href="../reference/get_cloud_file.html">get_cloud_file()</a></code> will only download a new copy of the file if it’s updated, avoiding extra time communication time with the cloud, and potential wait time for you.</p>
<p>One important note, in this case <code>file</code> is simply a character string. Unlike <code><a href="../reference/m365_cloud_files.html">sharepoint_file()</a></code> or <code><a href="../reference/m365_cloud_files.html">onedrive_file()</a></code>, this variable itself will <em>not</em> check if the file needs re-downloading. For that, you’ll have to use <code><a href="../reference/get_cloud_file.html">get_cloud_file()</a></code></p>
</div>
<div class="section level2">
<h2 id="writing-a-file">Writing a file<a class="anchor" aria-label="anchor" href="#writing-a-file"></a>
</h2>
<p>Ok - so we’ve covered reading for function which don’t accept file connection objects. What about writing? Admittedly, this a bit harder to work around elegantly - and I also see this as one of the bigger areas of improvement to m365filer. But, here’s what we’ve got.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Upload the file</span>
<span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ms365_drive_uploaders.html">upload_cloud_file</a></span><span class="op">(</span>
    <span class="va">write.csv</span>,
    <span class="st">'Documents/upload_file_test.csv'</span>,
    <span class="va">od</span>
  <span class="op">)</span>

<span class="co"># Download the example</span>
<span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="../reference/m365_cloud_files.html">onedrive_file</a></span><span class="op">(</span><span class="st">'Documents/upload_file_test.csv'</span>, drive<span class="op">=</span><span class="va">od</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">#&gt;                    mpg cyl</span>
<span class="co">#&gt; Mazda RX4         21.0   6</span>
<span class="co">#&gt; Mazda RX4 Wag     21.0   6</span>
<span class="co">#&gt; Datsun 710        22.8   4</span>
<span class="co">#&gt; Hornet 4 Drive    21.4   6</span>
<span class="co">#&gt; Hornet Sportabout 18.7   8</span>
<span class="co">#&gt; Valiant           18.1   6</span></code></pre>
<p>If you’re leveraging options, there are the additional variants <code><a href="../reference/ms365_drive_uploaders.html">upload_onedrive_file()</a></code> and <code><a href="../reference/ms365_drive_uploaders.html">upload_sharepoint_file()</a></code>, which just remove the need to reference a drive.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">'m365filer.onedrive'</span> <span class="op">=</span> <span class="fu">get_personal_onedrive</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/ms365_drive_uploaders.html">upload_onedrive_file</a></span><span class="op">(</span>
    <span class="va">write.csv</span>,
    <span class="st">'Documents/upload_file_test.csv'</span>
  <span class="op">)</span></code></pre></div>
<p>Note that the <code>writer</code> parameter of these function calls takes a function. There are a couple assumptions here:</p>
<ul>
<li>The provided function will write out a file</li>
<li>The first parameter of that function is the object be written</li>
<li>The second parameter of that function is the file path to which it should be written</li>
</ul>
<p>These are loose assumptions to say the least, but - a lot of the time they hold up. As stated, this is a huge area of opportunity for improvement. But the initial goal here was to make something that had <em>vaguely</em> the same feel of passing into a writer function directly.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mike Stackhouse.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
